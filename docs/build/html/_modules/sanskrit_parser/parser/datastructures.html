
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sanskrit_parser.parser.datastructures &#8212; sanskrit_parser 0.1.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for sanskrit_parser.parser.datastructures</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#</span>
<span class="sd">&quot;&quot;&quot; Sanskrit Parser Data Structures</span>

<span class="sd">    @author: Karthik Madathil (github: @kmadathil)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">sanskrit_parser.base.sanskrit_base</span> <span class="kn">import</span> <span class="n">SanskritObject</span><span class="p">,</span> <span class="n">SanskritImmutableString</span><span class="p">,</span> <span class="n">SLP1</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">islice</span><span class="p">,</span> <span class="n">product</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">splitext</span><span class="p">,</span> <span class="n">join</span>
<span class="kn">from</span> <span class="nn">sanskrit_parser.util</span> <span class="kn">import</span> <span class="n">lexical_scorer</span>
<span class="kn">from</span> <span class="nn">sanskrit_parser.util.disjoint_set</span> <span class="kn">import</span> <span class="n">DisjointSet</span>
<span class="kn">from</span> <span class="nn">sanskrit_parser.util.DhatuWrapper</span> <span class="kn">import</span> <span class="n">DhatuWrapper</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SandhiGraph&#39;</span><span class="p">,</span> <span class="s1">&#39;VakyaGraph&#39;</span><span class="p">,</span> <span class="s1">&#39;VakyaParse&#39;</span><span class="p">,</span> <span class="s1">&#39;getSLP1Tagset&#39;</span><span class="p">]</span>

<span class="n">dw</span> <span class="o">=</span> <span class="n">DhatuWrapper</span><span class="p">()</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="SandhiGraph"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph">[docs]</a><span class="k">class</span> <span class="nc">SandhiGraph</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; DAG class to hold Sandhi Lexical Analysis Results</span>

<span class="sd">        Represents the results of lexical sandhi analysis as a DAG</span>
<span class="sd">        Nodes are SanskritObjects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="s2">&quot;__start__&quot;</span>
    <span class="n">end</span> <span class="o">=</span> <span class="s2">&quot;__end__&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; DAG Class Init</span>

<span class="sd">        Params:</span>
<span class="sd">            elem (SanskritObject :optional:): Optional initial element</span>
<span class="sd">            end  (bool :optional:): Add end edge to initial element</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scorer</span> <span class="o">=</span> <span class="n">lexical_scorer</span><span class="o">.</span><span class="n">Scorer</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Iterate over nodes &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>

<div class="viewcode-block" id="SandhiGraph.has_node"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph.has_node">[docs]</a>    <span class="k">def</span> <span class="nf">has_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Does a given node exist in the graph?</span>

<span class="sd">            Params:</span>
<span class="sd">               t (SanskritObject): Node</span>
<span class="sd">            Returns:</span>
<span class="sd">               boolean</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span></div>

<div class="viewcode-block" id="SandhiGraph.append_to_node"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph.append_to_node">[docs]</a>    <span class="k">def</span> <span class="nf">append_to_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create edges from t to nodes</span>

<span class="sd">            Params:</span>
<span class="sd">                t (SanskritObject)      : Node to append to</span>
<span class="sd">                nodes (iterator(nodes)) : Nodes to append to t</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># t is in our graph</span>
        <span class="k">assert</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="SandhiGraph.add_node"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph.add_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extend dag with node inserted at root</span>

<span class="sd">            Params:</span>
<span class="sd">                Node (SanskritObject)      : Node to add</span>
<span class="sd">                root (Boolean)             : Make a root node</span>
<span class="sd">                end  (Boolean)             : Add an edge to end</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="SandhiGraph.add_end_edge"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph.add_end_edge">[docs]</a>    <span class="k">def</span> <span class="nf">add_end_edge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add an edge from node to end &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">)</span></div>

<div class="viewcode-block" id="SandhiGraph.add_roots"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph.add_roots">[docs]</a>    <span class="k">def</span> <span class="nf">add_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">roots</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">roots</span><span class="p">)</span></div>

<div class="viewcode-block" id="SandhiGraph.lock_start"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph.lock_start">[docs]</a>    <span class="k">def</span> <span class="nf">lock_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Make the graph ready for search by adding a start node</span>

<span class="sd">        Add a start node, add arcs to all current root nodes, and clear</span>
<span class="sd">        self.roots</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roots</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="SandhiGraph.score_graph"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph.score_graph">[docs]</a>    <span class="k">def</span> <span class="nf">score_graph</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">()</span>
        <span class="n">edges_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">edges_to_score</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="n">edges_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
                <span class="n">edges_to_score</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
            <span class="k">elif</span> <span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
                <span class="n">edges_to_score</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">edges_to_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorer</span><span class="o">.</span><span class="n">score_splits</span><span class="p">(</span><span class="n">edges_to_score</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">edge</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">edges_list</span><span class="p">,</span> <span class="n">scores</span><span class="p">):</span>
            <span class="c1"># Score is log-likelihood, so higher is better.</span>
            <span class="c1"># For graph path-finding, smaller weight is better, so use negative</span>
            <span class="n">edges</span><span class="p">[</span><span class="n">edge</span><span class="p">][</span><span class="s1">&#39;weight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">score</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;u = </span><span class="si">%s</span><span class="s2">, v = </span><span class="si">%s</span><span class="s2">, w = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span></div>

<div class="viewcode-block" id="SandhiGraph.find_all_paths"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph.find_all_paths">[docs]</a>    <span class="k">def</span> <span class="nf">find_all_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_paths</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">score</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Find all paths through DAG to End</span>

<span class="sd">            Params:</span>
<span class="sd">               max_paths (int :default:=10): Number of paths to find</span>
<span class="sd">                          If this is &gt; 1000, all paths will be found</span>
<span class="sd">               sort (bool)                 : If True (default), sort paths</span>
<span class="sd">                                             in ascending order of length</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">roots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lock_start</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">score</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">score_graph</span><span class="p">()</span>
        <span class="c1"># shortest_simple_paths is slow for &gt;1000 paths</span>
        <span class="k">if</span> <span class="n">max_paths</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">score</span><span class="p">:</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                           <span class="n">islice</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">shortest_simple_paths</span><span class="p">(</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">),</span>
                                                  <span class="n">max_paths</span><span class="p">)))</span>
                <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorer</span><span class="o">.</span><span class="n">score_splits</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
                <span class="n">path_scores</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
                <span class="n">sorted_path_scores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">path_scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Sorted paths with scores:</span><span class="se">\n</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sorted_path_scores</span><span class="p">)</span>
                <span class="c1"># Strip the scores from the returned result, to be consistent with no-scoring option</span>
                <span class="n">sorted_paths</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">sorted_path_scores</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">sorted_paths</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                           <span class="n">islice</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">shortest_simple_paths</span><span class="p">(</span>
                                                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">),</span>
                                                  <span class="n">max_paths</span><span class="p">)))</span>
                <span class="k">return</span> <span class="n">paths</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Fall back to all_simple_paths</span>
            <span class="n">ps</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">six</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">nx</span><span class="o">.</span><span class="n">all_simple_paths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">)))</span>
            <span class="c1"># If we do not intend to display paths, no need to sort them</span>
            <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
                <span class="n">ps</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">ps</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Print representation of DAG &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>

<div class="viewcode-block" id="SandhiGraph.draw"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_ncache</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span> <span class="nf">_uniq</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_ncache</span><span class="p">:</span>
                <span class="n">_ncache</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_ncache</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ncache</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_ncache</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="n">pos</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">),</span>
                <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">_uniq</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">})</span></div>

<div class="viewcode-block" id="SandhiGraph.write_dot"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.SandhiGraph.write_dot">[docs]</a>    <span class="k">def</span> <span class="nf">write_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="c1"># H = nx.convert_node_labels_to_integers(G, label_attribute=’node_label’)</span>
        <span class="c1"># H_layout = nx.nx_pydot.pydot_layout(G, prog=’dot’)</span>
        <span class="c1"># G_layout = {H.nodes[n][‘node_label’]: p for n, p in H_layout.items()}</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">write_dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></div></div>


<span class="n">lakaras</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;law&#39;</span><span class="p">,</span> <span class="s1">&#39;liw&#39;</span><span class="p">,</span> <span class="s1">&#39;luw&#39;</span><span class="p">,</span> <span class="s1">&#39;lrw&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">,</span> <span class="s1">&#39;laN&#39;</span><span class="p">,</span> <span class="s1">&#39;liN&#39;</span><span class="p">,</span> <span class="s1">&#39;luN&#39;</span><span class="p">,</span> <span class="s1">&#39;lfN&#39;</span><span class="p">,</span>
               <span class="s1">&#39;viDiliN&#39;</span><span class="p">,</span> <span class="s1">&#39;ASIrliN&#39;</span><span class="p">])</span>
<span class="n">krtverbs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;ktvA&#39;</span><span class="p">,</span> <span class="s1">&#39;Satf&#39;</span><span class="p">,</span> <span class="s1">&#39;Sanac&#39;</span><span class="p">,</span> <span class="s1">&#39;tumun&#39;</span><span class="p">,</span> <span class="s1">&#39;kta&#39;</span><span class="p">,</span> <span class="s1">&#39;ktavatu&#39;</span><span class="p">,</span> <span class="s1">&#39;lyap&#39;</span><span class="p">])</span>
<span class="n">purvakala</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;ktvA&#39;</span><span class="p">,</span> <span class="s1">&#39;lyap&#39;</span><span class="p">])</span>
<span class="n">samanakala</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;Satf&#39;</span><span class="p">,</span> <span class="s1">&#39;Sanac&#39;</span><span class="p">])</span>
<span class="n">nishta</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;kta&#39;</span><span class="p">,</span> <span class="s1">&#39;ktavatu&#39;</span><span class="p">])</span>
<span class="n">karmani</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;karmaRi&#39;</span><span class="p">])</span>
<span class="n">samastas</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;samAsapUrvapadanAmapadam&#39;</span><span class="p">])</span>
<span class="n">nijanta</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;RijantaH&#39;</span><span class="p">])</span>
<span class="c1"># Vibhaktis</span>
<span class="n">_vibhaktis</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;praTamAviBaktiH&#39;</span><span class="p">,</span> <span class="s1">&#39;dvitIyAviBaktiH&#39;</span><span class="p">,</span> <span class="s1">&#39;tftIyAviBaktiH&#39;</span><span class="p">,</span>
              <span class="s1">&#39;caturTIviBaktiH&#39;</span><span class="p">,</span> <span class="s1">&#39;paYcamIviBaktiH&#39;</span><span class="p">,</span> <span class="s1">&#39;zazWIviBaktiH&#39;</span><span class="p">,</span>
              <span class="s1">&#39;saptamIviBaktiH&#39;</span><span class="p">,</span> <span class="s1">&#39;saMboDanaviBaktiH&#39;</span><span class="p">]</span>
<span class="n">prathama</span> <span class="o">=</span> <span class="n">_vibhaktis</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">dvitiya</span> <span class="o">=</span> <span class="n">_vibhaktis</span><span class="p">[</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">tritiya</span> <span class="o">=</span> <span class="n">_vibhaktis</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">chaturthi</span> <span class="o">=</span> <span class="n">_vibhaktis</span><span class="p">[</span><span class="mi">4</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">pancami</span> <span class="o">=</span> <span class="n">_vibhaktis</span><span class="p">[</span><span class="mi">5</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">shashthi</span> <span class="o">=</span> <span class="n">_vibhaktis</span><span class="p">[</span><span class="mi">6</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">saptami</span> <span class="o">=</span> <span class="n">_vibhaktis</span><span class="p">[</span><span class="mi">7</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sambodhana</span> <span class="o">=</span> <span class="n">_vibhaktis</span><span class="p">[</span><span class="mi">8</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">vibhaktis</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_vibhaktis</span><span class="p">)</span>
<span class="c1"># Vacanas</span>
<span class="n">vacanas</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;ekavacanam&#39;</span><span class="p">,</span> <span class="s1">&#39;dvivacanam&#39;</span><span class="p">,</span> <span class="s1">&#39;bahuvacanam&#39;</span><span class="p">])</span>
<span class="c1"># Puruzas</span>
<span class="n">puruzas</span> <span class="o">=</span> <span class="s1">&#39;praTamapuruzaH&#39;</span><span class="p">,</span> <span class="s1">&#39;maDyamapuruzaH&#39;</span><span class="p">,</span> <span class="s1">&#39;uttamapuruzaH&#39;</span>
<span class="n">karakas</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;kartA&#39;</span><span class="p">,</span> <span class="s1">&#39;karma&#39;</span><span class="p">,</span> <span class="s1">&#39;karaRam&#39;</span><span class="p">,</span> <span class="s1">&#39;apAdAnam&#39;</span><span class="p">,</span> <span class="s1">&#39;sampradAnam&#39;</span><span class="p">,</span> <span class="s1">&#39;aDikaraRam&#39;</span><span class="p">,</span> <span class="s1">&#39;hetu-kartA&#39;</span><span class="p">])</span>
<span class="n">predicative_verbs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;as&#39;</span><span class="p">,</span> <span class="s1">&#39;BU&#39;</span><span class="p">,</span> <span class="s1">&#39;vft&#39;</span><span class="p">])</span>
<span class="n">_lingas</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;puMlliNgam&#39;</span><span class="p">,</span> <span class="s1">&#39;napuMsakaliNgam&#39;</span><span class="p">,</span> <span class="s1">&#39;strIliNgam&#39;</span><span class="p">,</span> <span class="s1">&#39;triliNgam&#39;</span><span class="p">]</span>
<span class="n">lingas</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">_lingas</span><span class="p">)</span>
<span class="n">napumsakam</span> <span class="o">=</span> <span class="n">_lingas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">avyaya</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;avyayam&#39;</span><span class="p">])</span>
<span class="n">kriyavisheshana</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;kriyAviSezaRam&#39;</span><span class="p">])</span>
<span class="n">nishedha</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;na&#39;</span><span class="p">])</span>
<span class="c1"># FIXME - api and su (pUjAyaM) in here temporarily - need a better solution</span>
<span class="n">karmap_null</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;su&#39;</span><span class="p">,</span> <span class="s1">&#39;api&#39;</span><span class="p">])</span>
<span class="n">avyaya_kriyav</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;kila&#39;</span><span class="p">,</span> <span class="s1">&#39;bata&#39;</span><span class="p">,</span> <span class="s1">&#39;aho&#39;</span><span class="p">,</span> <span class="s1">&#39;nanu&#39;</span><span class="p">,</span> <span class="s1">&#39;hanta&#39;</span><span class="p">,</span> <span class="s1">&#39;eva&#39;</span><span class="p">,</span> <span class="s1">&#39;tu&#39;</span><span class="p">])</span>
<span class="n">projlabels</span> <span class="o">=</span> <span class="n">karakas</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">kriyavisheshana</span><span class="p">)</span>
<span class="c1"># sambaddha links are projective</span>
<span class="n">samplabels</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sambadDa-&#39;</span><span class="o">+</span><span class="n">lbl</span> <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">projlabels</span><span class="p">}</span><span class="o">.</span><span class="n">union</span><span class="p">({</span><span class="s1">&#39;saMbadDakriyA&#39;</span><span class="p">})</span>
<span class="n">projlabels</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">samplabels</span><span class="p">)</span>
<span class="n">sentence_conjunctions</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;yad&quot;</span><span class="p">:</span> <span class="s2">&quot;tad&quot;</span><span class="p">,</span> <span class="s2">&quot;yadi&quot;</span><span class="p">:</span> <span class="s2">&quot;tarhi&quot;</span><span class="p">,</span> <span class="s2">&quot;yatra&quot;</span><span class="p">:</span> <span class="s2">&quot;tatra&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;yAvat&quot;</span><span class="p">:</span> <span class="s2">&quot;tAvat&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;yaTA&quot;</span><span class="p">:</span> <span class="s2">&quot;taTA&quot;</span><span class="p">,</span> <span class="s2">&quot;api&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;cet&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;yat&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                         <span class="s2">&quot;natu&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;ca&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="n">conjunctions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sentence_conjunctions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># Non Karaka Vibhakti</span>
<span class="n">non_karaka_vibhaktis</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;antarA&quot;</span><span class="p">,</span> <span class="s2">&quot;antareRa&quot;</span><span class="p">,</span> <span class="s2">&quot;pfTak&quot;</span><span class="p">,</span> <span class="s2">&quot;vinA&quot;</span><span class="p">,</span> <span class="s2">&quot;nAnA&quot;</span><span class="p">],</span>
    <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;saha&quot;</span><span class="p">,</span> <span class="s2">&quot;pfTak&quot;</span><span class="p">,</span> <span class="s2">&quot;vinA&quot;</span><span class="p">,</span> <span class="s2">&quot;nAnA&quot;</span><span class="p">],</span>
    <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;namaH&quot;</span><span class="p">,</span> <span class="s2">&quot;svasti&quot;</span><span class="p">,</span> <span class="s2">&quot;svAhA&quot;</span><span class="p">,</span> <span class="s2">&quot;alam&quot;</span><span class="p">,</span> <span class="s2">&quot;vazaw&quot;</span><span class="p">],</span>
    <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;anya&quot;</span><span class="p">,</span> <span class="s2">&quot;Arat&quot;</span><span class="p">,</span> <span class="s2">&quot;itara&quot;</span><span class="p">,</span> <span class="s2">&quot;fte&quot;</span><span class="p">,</span> <span class="s2">&quot;pfTak&quot;</span><span class="p">,</span> <span class="s2">&quot;vinA&quot;</span><span class="p">,</span> <span class="s2">&quot;nAnA&quot;</span><span class="p">],</span>
<span class="p">}</span>
<span class="c1"># FIXME Merge these with above</span>
<span class="n">karmap_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;anu&#39;</span><span class="p">,</span> <span class="s1">&#39;upa&#39;</span><span class="p">,</span>  <span class="s1">&#39;prati&#39;</span><span class="p">,</span> <span class="s1">&#39;aBi&#39;</span><span class="p">,</span> <span class="s1">&#39;aDi&#39;</span><span class="p">,</span> <span class="s1">&#39;ati&#39;</span><span class="p">])</span>
<span class="n">karmap_5</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;apa&#39;</span><span class="p">,</span> <span class="s1">&#39;pari&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;prati&#39;</span><span class="p">])</span>

<span class="c1"># Edge costs used for ordering</span>
<span class="n">edge_cost</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">karakas</span><span class="p">:</span>
    <span class="n">edge_cost</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">edge_cost</span><span class="p">[</span><span class="s1">&#39;karma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.85</span>
<span class="n">edge_cost</span><span class="p">[</span><span class="s1">&#39;kartA&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.8</span>


<div class="viewcode-block" id="VakyaGraph"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph">[docs]</a><span class="k">class</span> <span class="nc">VakyaGraph</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; DAG class for Sanskrit Vakya Analysis</span>

<span class="sd">        Represents Sanskrit Vakya Analysis as a DAG</span>
<span class="sd">        Nodes are SanskritObjects with morphological tags</span>
<span class="sd">        Edges are potential relationships between them</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">max_parse_dc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fast_merge</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; DAG Class Init</span>

<span class="sd">        Params:</span>
<span class="sd">             path: Path from SandhiGraph</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_parse_dc</span> <span class="o">=</span> <span class="n">max_parse_dc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_merge</span> <span class="o">=</span> <span class="n">fast_merge</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">roots</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isLocked</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Multigraph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">MultiDiGraph</span><span class="p">()</span>  <span class="c1"># Allow parallel edges</span>
        <span class="c1"># Need this many nodes in the extracted subgraphs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path_node_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">path_node_count</span><span class="si">}</span><span class="s2"> sets of orthogonal nodes&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partitions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">sobj</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">vnlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mtags</span> <span class="o">=</span> <span class="n">sobj</span><span class="o">.</span><span class="n">getMorphologicalTags</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">mtag</span> <span class="ow">in</span> <span class="n">mtags</span><span class="p">:</span>
                <span class="n">ncopy</span> <span class="o">=</span> <span class="n">SanskritObject</span><span class="p">(</span><span class="n">sobj</span><span class="o">.</span><span class="n">canonical</span><span class="p">(),</span>
                                       <span class="n">encoding</span><span class="o">=</span><span class="n">SLP1</span><span class="p">,</span>
                                       <span class="n">replace_ending_visarga</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">ncopy</span><span class="o">.</span><span class="n">setMorphologicalTags</span><span class="p">(</span><span class="n">mtag</span><span class="p">)</span>
                <span class="n">pn</span> <span class="o">=</span> <span class="n">VakyaGraphNode</span><span class="p">(</span><span class="n">ncopy</span><span class="p">,</span> <span class="n">ix</span><span class="p">)</span>
                <span class="n">vnlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">vn</span> <span class="ow">in</span> <span class="n">vnlist</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">vn</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">vnlist</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node Partitions </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="si">}</span><span class="s2"> Len </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_edges</span><span class="p">()</span>
        <span class="c1"># Remove isolated nodes (with no edges)</span>
        <span class="n">isolates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nx</span><span class="o">.</span><span class="n">isolates</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">remove_nodes_from</span><span class="p">(</span><span class="n">isolates</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ix</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">):</span>
            <span class="n">s</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">isolates</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Partition </span><span class="si">{</span><span class="n">ix</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">path</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="si">}</span><span class="s2"> went to zero length!&quot;</span><span class="p">)</span>
        <span class="n">start_parse</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parses_dc</span><span class="p">()</span>
        <span class="n">end_parse</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_parse_validity</span><span class="p">()</span>
        <span class="n">end_check</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_costs</span> <span class="o">=</span> <span class="n">_order_parses</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parses</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time for parse: </span><span class="si">{</span><span class="p">(</span><span class="n">end_parse</span><span class="o">-</span><span class="n">start_parse</span><span class="p">)</span><span class="si">:</span><span class="s2">1.6f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total for Global Check: </span><span class="si">{</span><span class="p">(</span><span class="n">end_check</span><span class="o">-</span><span class="n">end_parse</span><span class="p">)</span><span class="si">:</span><span class="s2">1.6f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Time for parse: </span><span class="si">{</span><span class="p">(</span><span class="n">end_check</span><span class="o">-</span><span class="n">start_parse</span><span class="p">)</span><span class="si">:</span><span class="s2">1.6f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Iterate over nodes &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Print representation of DAG &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)</span>

<div class="viewcode-block" id="VakyaGraph.lock"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isLocked</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="VakyaGraph.add_node"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Extend dag with node inserted at root</span>

<span class="sd">            Params:</span>
<span class="sd">                Node (VakyaGraphNode)      : Node to add</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLocked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_edges"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_edges">[docs]</a>    <span class="k">def</span> <span class="nf">add_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">isLocked</span>
        <span class="n">laks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_lakaras</span><span class="p">()</span>
        <span class="n">krts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_krtverbs</span><span class="p">()</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">laks</span><span class="p">)</span>
        <span class="n">bases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">krts</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Adding Edges&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_karakas</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_samastas</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_shashthi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_kriyavisheshana</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span>  <span class="c1"># FIXME Parallel edge problem</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_visheshana</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_kriya_kriya</span><span class="p">(</span><span class="n">laks</span><span class="p">,</span> <span class="n">krts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_avyayas</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_bhavalakshana</span><span class="p">(</span><span class="n">krts</span><span class="p">,</span> <span class="n">laks</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_non_karaka_vibhaktis</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_vipsa</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_sentence_conjunctions</span><span class="p">(</span><span class="n">laks</span><span class="p">,</span> <span class="n">krts</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.find_krtverbs"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.find_krtverbs">[docs]</a>    <span class="k">def</span> <span class="nf">find_krtverbs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Find non ti~Nanta verbs&#39;&#39;&#39;</span>
        <span class="n">rlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">krtverbs</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> is a possible Krt Dhatu&quot;</span><span class="p">)</span>
                <span class="n">rlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rlist</span></div>

<div class="viewcode-block" id="VakyaGraph.find_lakaras"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.find_lakaras">[docs]</a>    <span class="k">def</span> <span class="nf">find_lakaras</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Find the ti~Nanta &#39;&#39;&#39;</span>
        <span class="n">rlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">lakaras</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> is a possible Dhatu&quot;</span><span class="p">)</span>
                <span class="n">rlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rlist</span></div>

<div class="viewcode-block" id="VakyaGraph.add_visheshana"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_visheshana">[docs]</a>    <span class="k">def</span> <span class="nf">add_visheshana</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">vibhaktis</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">no</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">_is_same_partition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">no</span><span class="p">))</span> <span class="ow">and</span> <span class="n">match_linga_vacana_vibhakti</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">no</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">!=</span> <span class="n">_get_base</span><span class="p">(</span><span class="n">no</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding viSezaRa edge: </span><span class="si">{</span><span class="n">n</span><span class="p">,</span><span class="n">no</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">no</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;viSezaRam&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_vipsa"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_vipsa">[docs]</a>    <span class="k">def</span> <span class="nf">add_vipsa</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">no</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="p">(</span><span class="n">no</span><span class="o">.</span><span class="n">index</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">pada</span><span class="o">.</span><span class="n">canonical</span><span class="p">()</span> <span class="o">==</span> <span class="n">no</span><span class="o">.</span><span class="n">pada</span><span class="o">.</span><span class="n">canonical</span><span class="p">()):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding vIpsa edge: </span><span class="si">{</span><span class="n">n</span><span class="p">,</span> <span class="n">no</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">no</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;vIpsA&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_samastas"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_samastas">[docs]</a>    <span class="k">def</span> <span class="nf">add_samastas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add samasta links from next samasta/tiN &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="c1"># If node is a samasta, check options for</span>
                <span class="c1"># next node, and add samasta links if tiN</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">samastas</span><span class="p">):</span>
                    <span class="c1"># Cant have samasta as last node</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">nextset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">nextset</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">nn</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">vibhaktis</span><span class="p">)</span> <span class="ow">or</span> \
                               <span class="n">nn</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">samastas</span><span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding samasta edge: </span><span class="si">{</span><span class="n">n</span><span class="p">,</span><span class="n">nn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;samasta&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_shashthi"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_shashthi">[docs]</a>    <span class="k">def</span> <span class="nf">add_shashthi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add zazWI-sambanDa links to next tiN &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="c1"># If node is a shashthi, check</span>
                <span class="c1"># next node, and add links if tiN</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">shashthi</span><span class="p">):</span>
                    <span class="c1"># Cant have sambandha open at last node</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">nextset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">nextset</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">nn</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">vibhaktis</span><span class="p">)</span> <span class="ow">or</span> \
                               <span class="n">nn</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">samastas</span><span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding shashthi-sambandha edge: </span><span class="si">{</span><span class="n">n</span><span class="p">,</span><span class="n">nn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;zazWI-sambanDa&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_karakas"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_karakas">[docs]</a>    <span class="k">def</span> <span class="nf">add_karakas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add karaka edges from base node (dhatu) base &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">dh</span> <span class="o">=</span> <span class="n">_get_base</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">canonical</span><span class="p">()</span>
            <span class="n">hpos</span> <span class="o">=</span> <span class="n">dh</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hpos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">dh</span> <span class="o">=</span> <span class="n">dh</span><span class="p">[:</span><span class="n">hpos</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">lakaras</span><span class="p">)</span> <span class="ow">or</span> <span class="n">d</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="s1">&#39;avyayaDAturUpa&#39;</span><span class="p">):</span>
                <span class="n">is_sak</span> <span class="o">=</span> <span class="n">dw</span><span class="o">.</span><span class="n">is_sakarmaka</span><span class="p">(</span><span class="n">dh</span><span class="p">)</span>
                <span class="n">is_dvik</span> <span class="o">=</span> <span class="n">dw</span><span class="o">.</span><span class="n">is_dvikarmaka</span><span class="p">(</span><span class="n">dh</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">is_sak</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># No way of knowing, set True</span>
                <span class="n">is_dvik</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dhatu: </span><span class="si">{</span><span class="n">dh</span><span class="si">}</span><span class="s2"> Sakarmaka </span><span class="si">{</span><span class="n">is_sak</span><span class="si">}</span><span class="s2"> Dvikarmaka </span><span class="si">{</span><span class="n">is_dvik</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">karmani</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Karmani&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Kartari&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">nijanta</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Nijanta Dhatu&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_same_partition</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">karmani</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">tritiya</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">nijanta</span><span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding hetu-kartA edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;hetu-kartA&quot;</span><span class="p">)</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding kartA edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;kartA&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">prathama</span><span class="p">)</span> <span class="ow">and</span> <span class="n">match_purusha_vacana</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                              <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">lakaras</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_sak</span><span class="p">):</span>
                            <span class="c1"># Only Lakaras and kartari krts are allowed</span>
                            <span class="c1"># Karma</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding karma edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;karma&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">is_dvik</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding gauRakarma edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;gauRa-karma&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">prathama</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">lakaras</span><span class="p">)</span> <span class="ow">and</span> <span class="n">match_purusha_vacana</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">nijanta</span><span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding hetu-kartA edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;hetu-kartA&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding kartA edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;kartA&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">tritiya</span><span class="p">)</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">nijanta</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding kartA edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;kartA&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">dvitiya</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_sak</span><span class="p">):</span>
                            <span class="c1"># Lakaras and Kartari krts are allowed</span>
                            <span class="c1"># Karma</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding karma edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;karma&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">is_dvik</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding gauRakarma edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;gauRa-karma&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">tritiya</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding karana edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;karaRam&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">chaturthi</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding sampradana edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;sampradAnam&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">pancami</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding apadana edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;apAdanam&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">saptami</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding adhikarana edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;aDikaraRam&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">sambodhana</span><span class="p">)</span> <span class="ow">and</span> <span class="n">check_sambodhya</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding sambodhya edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;samboDyam&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_kriyavisheshana"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_kriyavisheshana">[docs]</a>    <span class="k">def</span> <span class="nf">add_kriyavisheshana</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add kriyaviSezaRa edges from base node (dhatu) base &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_same_partition</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">avyaya</span><span class="p">)</span> <span class="ow">and</span> \
                         <span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">kriyavisheshana</span><span class="p">)</span> <span class="ow">or</span>
                          <span class="n">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">avyaya_kriyav</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding kriyAviSezaRa edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;kriyAviSezaRam&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_kriya_kriya"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_kriya_kriya">[docs]</a>    <span class="k">def</span> <span class="nf">add_kriya_kriya</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lakaras</span><span class="p">,</span> <span class="n">krts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add kriya-kriya edges from lakaras to krts&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">lakaras</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">krts</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_same_partition</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">purvakala</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding pUrvakAlaH edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;pUrvakAlaH&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="s1">&#39;tumun&#39;</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding prayojanam edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;prayojanam&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">samanakala</span><span class="p">)</span> <span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">prathama</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding samAnakAlaH edge to </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;samAnakAlaH&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_avyayas"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_avyayas">[docs]</a>    <span class="k">def</span> <span class="nf">add_avyayas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bases</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add Avyaya Links &#39;&#39;&#39;</span>
        <span class="c1"># Upasargas</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="s1">&#39;upasargaH&#39;</span><span class="p">):</span>
                    <span class="c1"># Cant have upasargas at last node</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">nextset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="c1"># Upasarga to upasarga links ok</span>
                        <span class="c1"># Upasarga to any verb form barring ktvA</span>
                        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">nextset</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">((</span><span class="n">nn</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nn</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="s1">&#39;ktvA&#39;</span><span class="p">))</span> <span class="ow">or</span> \
                               <span class="n">nn</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="s1">&#39;upasargaH&#39;</span><span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding upasarga edge: </span><span class="si">{</span><span class="n">n</span><span class="p">,</span><span class="n">nn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;upasargaH&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">avyaya</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nishedha</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_same_partition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding nishedha edge: </span><span class="si">{</span><span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;nizeDa&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="s1">&#39;karmapravacanIyaH&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">avyaya_kriyav</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span><span class="p">(</span><span class="n">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">karmap_null</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_same_partition</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding karmapravacaniya edge: </span><span class="si">{</span><span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;karmapravacanIyaH&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">nextset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">nextset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">prevset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">prevset</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
                    <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="n">nextset</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">prevset</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">nn</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">dvitiya</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">karmap_2</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding karmapravacaniya upapada 2 edge: </span><span class="si">{</span><span class="n">n</span><span class="p">,</span><span class="n">nn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;upapada-dvitIyA&quot;</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">nn</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">pancami</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">karmap_5</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding karmapravacaniya upapada 5 edge: </span><span class="si">{</span><span class="n">n</span><span class="p">,</span><span class="n">nn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;upapada-pancamI&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_bhavalakshana"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_bhavalakshana">[docs]</a>    <span class="k">def</span> <span class="nf">add_bhavalakshana</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">krts</span><span class="p">,</span> <span class="n">laks</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add bhavalakshana edges from saptami krts to lakaras &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">krts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">saptami</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">lak</span> <span class="ow">in</span> <span class="n">laks</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_same_partition</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">lak</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding Bhavalakshana edge: </span><span class="si">{</span><span class="n">k</span><span class="p">,</span> <span class="n">lak</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">lak</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;BAvalakzaRam&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_non_karaka_vibhaktis"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_non_karaka_vibhaktis">[docs]</a>    <span class="k">def</span> <span class="nf">add_non_karaka_vibhaktis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add Non-Karaka Vibhaktis &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="n">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">non_karaka_vibhaktis</span><span class="p">)</span> <span class="ow">and</span> \
                   <span class="p">(</span><span class="n">nb</span> <span class="ow">in</span> <span class="n">non_karaka_vibhaktis</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
                        <span class="n">vlabel</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;upapada-&quot;</span><span class="o">+</span><span class="n">_vibhaktis</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;viBakti&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">nn</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">_vibhaktis</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="ow">and</span> \
                           <span class="p">(</span><span class="ow">not</span> <span class="n">_is_same_partition</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="p">)):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding </span><span class="si">{</span><span class="n">vlabel</span><span class="si">}</span><span class="s2"> edge </span><span class="si">{</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">vlabel</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.add_sentence_conjunctions"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.add_sentence_conjunctions">[docs]</a>    <span class="k">def</span> <span class="nf">add_sentence_conjunctions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">laks</span><span class="p">,</span> <span class="n">krts</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Add sentence conjunction links</span>

<span class="sd">        For all nodes which match sentence_conjuction keys</span>
<span class="sd">        add vAkyasambanDaH link between y-t pair</span>
<span class="sd">              - if vibhakti matches where relevant</span>
<span class="sd">        Reverse all edges to node, add sambadDa- to link label (eg sambadDa-karma, if node is not vIpsa</span>
<span class="sd">        if node is saMyojakaH, and not vIpsA add saMbadDakriyA links to verbs</span>
<span class="sd">        if associated t* doesn&#39;t exist vAkyasambanDaH links from verbs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">_is_vipsa</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">kd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">pred</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1"># Multigraph</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">kd</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;vIpsA&#39;</span><span class="p">:</span>
                        <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Only prathama krts are needed here. The rest aren&#39;t relevant</span>
        <span class="n">bases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bases</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">laks</span><span class="p">)</span>
        <span class="n">bases</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">krts</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">prathama</span><span class="p">)])</span>
        <span class="n">sentence_conjunctions_y</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">sentence_conjunctions</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
            <span class="n">nb</span> <span class="o">=</span> <span class="n">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nb</span> <span class="ow">in</span> <span class="n">sentence_conjunctions_y</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_vipsa</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                    <span class="c1"># Reverse edges, add sambadDa label</span>
                    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">kd</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">pred</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kd</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;sambadDa-&#39;</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])</span>
                    <span class="c1"># Matching pair</span>
                    <span class="n">s_t</span> <span class="o">=</span> <span class="n">sentence_conjunctions</span><span class="p">[</span><span class="n">nb</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">_is_vipsa</span><span class="p">(</span><span class="n">nn</span><span class="p">))</span> <span class="ow">and</span> <span class="n">_get_base</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span> <span class="o">==</span> <span class="n">s_t</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">match_linga_vacana</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nn</span><span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding vAkyasambanDaH edge: </span><span class="si">{</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;vAkyasambanDaH&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="s1">&#39;saMyojakaH&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">nn</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding saMbadDakriyA edge: </span><span class="si">{</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">nn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;saMbadDakriyA&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">s_t</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adding vAkyasambanDaH edge: </span><span class="si">{</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">nn</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;vAkyasambanDaH&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.get_parses_dc"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.get_parses_dc">[docs]</a>    <span class="k">def</span> <span class="nf">get_parses_dc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns all parses</span>

<span class="sd">            Uses modified Kruskal Algorithm to compute (generalized) spanning</span>
<span class="sd">            tree of k-partite VakyaGraph</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Computing Parses (Divide &amp; Conquer)&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_get_parse_sub</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">):</span>
            <span class="c1"># Iterate over subsets of disjoint nodesets</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">ns</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">partitions</span><span class="p">,</span> <span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">)):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Node set number </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">ns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Partial parses = phi + all predecessors</span>
                    <span class="n">partial_parses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                    <span class="n">partial_parses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">VakyaParse</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>  <span class="c1"># Null partial parse</span>
                    <span class="c1"># For all input edges to this set</span>
                    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traversing node </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traversing predecessor </span><span class="si">{</span><span class="n">pred</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="n">partial_parses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">VakyaParse</span><span class="p">((</span><span class="n">pred</span><span class="p">,</span> <span class="n">n</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">store_parses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                    <span class="n">small_parses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">ps</span> <span class="ow">in</span> <span class="n">partial_parses</span><span class="p">:</span>  <span class="c1"># For each partial parse</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">:</span>  <span class="c1"># Small parses to be removed</span>
                            <span class="n">small_parses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>  <span class="c1"># For all input edges to this set</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traversing node </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">pred</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Traversing predecessor </span><span class="si">{</span><span class="n">pred</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="c1"># If edge is compatible with partial parse, add and create new partial parse</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trying to extend parse </span><span class="si">{</span><span class="n">ps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">ps</span><span class="o">.</span><span class="n">is_safe</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pred</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> is safe for </span><span class="si">{</span><span class="n">ps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                                    <span class="n">psc</span> <span class="o">=</span> <span class="n">ps</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Copy the nodeset and DisjointSet structures</span>
                                    <span class="n">psc</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                                    <span class="n">store_parses</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">psc</span><span class="p">)</span>
                    <span class="n">partial_parses</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">small_parses</span><span class="p">)</span>
                    <span class="n">partial_parses</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">store_parses</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Partial Parses&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">partial_parses</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">partial_parses</span>

        <span class="c1"># Divide &amp; Conquer routine</span>
        <span class="k">def</span> <span class="nf">_dc</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Divide And Conquer </span><span class="si">{</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="n">mn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_parse_dc</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">mx</span> <span class="o">+</span> <span class="n">mn</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">_merge_partials</span><span class="p">(</span><span class="n">_dc</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="n">md</span><span class="p">),</span> <span class="n">_dc</span><span class="p">(</span><span class="n">md</span><span class="p">,</span> <span class="n">mx</span><span class="p">),</span> <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">_get_parse_sub</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">t</span>

        <span class="k">def</span> <span class="nf">_merge_partials</span><span class="p">(</span><span class="n">pp1</span><span class="p">,</span> <span class="n">pp2</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="n">mn</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merging between </span><span class="si">{</span><span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pp1</span><span class="p">)</span><span class="si">}</span><span class="s2"> x </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pp2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merging </span><span class="si">{</span><span class="n">pp1</span><span class="p">,</span> <span class="n">pp2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">ppmt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">ppa</span> <span class="ow">in</span> <span class="n">pp1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ppb</span> <span class="ow">in</span> <span class="n">pp2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_merge</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ppa</span><span class="o">.</span><span class="n">can_merge</span><span class="p">(</span><span class="n">ppb</span><span class="p">,</span> <span class="n">mx</span><span class="o">-</span><span class="n">mn</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                            <span class="n">ppmt</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ppa</span><span class="o">.</span><span class="n">merge_f</span><span class="p">(</span><span class="n">ppb</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Slow Merge</span>
                        <span class="n">merged</span> <span class="o">=</span> <span class="n">ppa</span><span class="o">.</span><span class="n">merge_s</span><span class="p">(</span><span class="n">ppb</span><span class="p">,</span> <span class="n">mx</span><span class="o">-</span><span class="n">mn</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">merged</span><span class="p">:</span>
                            <span class="n">ppmt</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ppmt</span><span class="p">)</span><span class="si">}</span><span class="s2"> parses&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Merged </span><span class="si">{</span><span class="n">ppmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time for merge </span><span class="si">{</span><span class="n">end_time</span><span class="o">-</span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ppmt</span>

        <span class="n">partial_parses</span> <span class="o">=</span> <span class="n">_dc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path_node_count</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Partial Parses Before Return </span><span class="si">{</span><span class="n">partial_parses</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Multigraph</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">.</span><span class="n">edge_subgraph</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">partial_parses</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">multiedgesets</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">)])</span></div>

<div class="viewcode-block" id="VakyaGraph.check_parse_validity"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.check_parse_validity">[docs]</a>    <span class="k">def</span> <span class="nf">check_parse_validity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Validity Check for parses</span>

<span class="sd">            Remove parses with double kArakas</span>
<span class="sd">            Remove parses with multiple to edges into a node</span>
<span class="sd">            Remove parses with cycles</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">iv</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parses before validity check </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parses</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parses</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_check_parse</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Will remove </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">iv</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>  <span class="c1"># Collect invalid parses</span>
        <span class="c1"># Remove them</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parses</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="n">iv</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parses after validity check </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parses</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaGraph.draw"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">_ncache</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">def</span> <span class="nf">_uniq</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">s</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_ncache</span><span class="p">:</span>
                <span class="n">_ncache</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="n">s</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_ncache</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ncache</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_ncache</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

        <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="n">pos</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">graph_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">_uniq</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">})</span></div>

<div class="viewcode-block" id="VakyaGraph.write_dot"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaGraph.write_dot">[docs]</a>    <span class="k">def</span> <span class="nf">write_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">write_dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">be</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">splitext</span><span class="p">(</span><span class="n">be</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parses</span><span class="p">):</span>
            <span class="n">pt</span> <span class="o">=</span> <span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">b</span><span class="o">+</span><span class="sa">f</span><span class="s2">&quot;_parse</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">e</span><span class="p">)</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">drawing</span><span class="o">.</span><span class="n">nx_pydot</span><span class="o">.</span><span class="n">write_dot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pt</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">VakyaGraphNode</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Class for VakyaGraph nodes</span>

<span class="sd">        This has pada (a SanskritObject) plus a list of disjoint nodes</span>
<span class="sd">        to which edges cannot be created from this node</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sobj</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pada</span> <span class="o">=</span> <span class="n">sobj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>

    <span class="k">def</span> <span class="nf">getMorphologicalTags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pada</span><span class="o">.</span><span class="n">getMorphologicalTags</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">getNodeTagset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Given a Node, extract the tagset &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">getSLP1Tagset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getMorphologicalTags</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">node_is_a</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">st</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Check if node matches a particular tag or any of a set of tags &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">st</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeTagset</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">st</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNodeTagset</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;node_is_a: expecting str or set, got </span><span class="si">{</span><span class="n">st</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_vibhakti</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get Node vacana &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeTagset</span><span class="p">()</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">vibhaktis</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_vacana</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get Node vacana &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeTagset</span><span class="p">()</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">vacanas</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_linga</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get Node linga &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeTagset</span><span class="p">()</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">lingas</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_purusha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Get Node puruza &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeTagset</span><span class="p">()</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">puruzas</span><span class="p">)</span>

    <span class="c1"># FIXME: not needed?</span>
    <span class="k">def</span> <span class="nf">get_node_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">pada</span><span class="o">.</span><span class="n">canonical</span><span class="p">())</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pada</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pada</span><span class="o">.</span><span class="n">getMorphologicalTags</span><span class="p">())</span> <span class="o">+</span> \
            <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<div class="viewcode-block" id="VakyaParse"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaParse">[docs]</a><span class="k">class</span> <span class="nc">VakyaParse</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodepair</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Initializes a partial parse with a node pair (or []) &#39;&#39;&#39;</span>
        <span class="c1"># DisjointSet  (as in Kruskal)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span> <span class="o">=</span> <span class="n">DisjointSet</span><span class="p">()</span>
        <span class="c1"># &quot;Extinguished&quot; nodes - nodes from partitions whose representatives</span>
        <span class="c1"># Have been added to the forest/ST already</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extinguished</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># Nodes in the forest/ST</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activenodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nodepair</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate</span><span class="p">(</span><span class="n">nodepair</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Edges in the forest/ST</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">([(</span><span class="n">u</span><span class="o">.</span><span class="n">pada</span><span class="o">.</span><span class="n">canonical</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">pada</span><span class="o">.</span><span class="n">canonical</span><span class="p">())</span> <span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_populate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodepair</span><span class="p">):</span>
        <span class="c1"># Add first edge to forest</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([(</span><span class="n">nodepair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodepair</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nodepair</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activate_and_extinguish_alternatives</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">nodepair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nodepair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<div class="viewcode-block" id="VakyaParse.activate_and_extinguish_alternatives"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaParse.activate_and_extinguish_alternatives">[docs]</a>    <span class="k">def</span> <span class="nf">activate_and_extinguish_alternatives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Make node active, extinguish other nodes in its partition &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activenodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extinguished</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaParse.is_extinguished"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaParse.is_extinguished">[docs]</a>    <span class="k">def</span> <span class="nf">is_extinguished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Is a node extinguished &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extinguished</span><span class="p">)</span> <span class="ow">and</span> \
            <span class="p">(</span><span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activenodes</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaParse.is_safe"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaParse.is_safe">[docs]</a>    <span class="k">def</span> <span class="nf">is_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Checks if a partial parse is compatible with a given node and predecessor pair &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_extinguished</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_extinguished</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">pred</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activenodes</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activenodes</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">connected</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">r</span></div>

<div class="viewcode-block" id="VakyaParse.extend"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaParse.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Extend current parse with edge from pred to node &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">activenodes</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Populating </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">node</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate</span><span class="p">((</span><span class="n">pred</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Extending </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span><span class="n">node</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pred</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activenodes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">activate_and_extinguish_alternatives</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">activenodes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">activate_and_extinguish_alternatives</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">pred</span><span class="p">,</span> <span class="n">node</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Edges </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="VakyaParse.can_merge"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaParse.can_merge">[docs]</a>    <span class="k">def</span> <span class="nf">can_merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Can we merge two VakyaParses &#39;&#39;&#39;</span>
        <span class="c1"># Proper length</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># No extinguished nodes</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">activenodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_extinguished</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># No cycles</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">conn</span><span class="o">.</span><span class="n">connected</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="VakyaParse.merge_f"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaParse.merge_f">[docs]</a>    <span class="k">def</span> <span class="nf">merge_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Merge two VakyaParses: Fast method &#39;&#39;&#39;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Merging&quot;</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">extinguished</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">extinguished</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">activenodes</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">activenodes</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="n">t</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span></div>

<div class="viewcode-block" id="VakyaParse.merge_s"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaParse.merge_s">[docs]</a>    <span class="k">def</span> <span class="nf">merge_s</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Merge two VakyaParses: Slow method &#39;&#39;&#39;</span>
        <span class="c1"># Proper length</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">is_safe</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
                <span class="n">t</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">t</span></div>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

<div class="viewcode-block" id="VakyaParse.copy"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.VakyaParse.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Return a one level deep copy - in between a shallow and a fully deep copy &#39;&#39;&#39;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">VakyaParse</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">activenodes</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">activenodes</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">edges</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">extinguished</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extinguished</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">connections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">t</span></div></div>


<div class="viewcode-block" id="getSLP1Tagset"><a class="viewcode-back" href="../../../sanskrit_parser_parser_datastructures.html#sanskrit_parser.parser.datastructures.getSLP1Tagset">[docs]</a><span class="k">def</span> <span class="nf">getSLP1Tagset</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Given a (base, tagset) pair, extract the tagset &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">canonical</span><span class="p">(),</span> <span class="nb">list</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span></div>


<span class="k">def</span> <span class="nf">match_purusha_vacana</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Check vacana/puruza compatibility for a Dhatu d and node n &#39;&#39;&#39;</span>
    <span class="n">n_base</span> <span class="o">=</span> <span class="n">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_base</span> <span class="o">==</span> <span class="s1">&#39;asmad&#39;</span><span class="p">:</span>
        <span class="n">n_purusha</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">puruzas</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">n_base</span> <span class="o">==</span> <span class="s1">&#39;yuzmad&#39;</span><span class="p">:</span>
        <span class="n">n_purusha</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">puruzas</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_purusha</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">puruzas</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get_vacana</span><span class="p">()</span> <span class="o">==</span> <span class="n">n</span><span class="o">.</span><span class="n">get_vacana</span><span class="p">())</span> <span class="ow">and</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get_purusha</span><span class="p">()</span> <span class="o">==</span> <span class="n">n_purusha</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">match_linga_vacana</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Check linga/puruza compatibility for two nodes &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n1</span><span class="o">.</span><span class="n">get_vacana</span><span class="p">()</span> <span class="o">==</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_vacana</span><span class="p">())</span> <span class="ow">and</span> \
        <span class="p">(</span><span class="n">n1</span><span class="o">.</span><span class="n">get_linga</span><span class="p">()</span> <span class="o">==</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_linga</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">match_linga_vacana_vibhakti</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n1</span><span class="o">.</span><span class="n">get_vacana</span><span class="p">()</span> <span class="o">==</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_vacana</span><span class="p">())</span> <span class="ow">and</span> \
        <span class="p">(</span><span class="n">n1</span><span class="o">.</span><span class="n">get_linga</span><span class="p">()</span> <span class="o">==</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_linga</span><span class="p">())</span> <span class="ow">and</span> \
        <span class="p">(</span><span class="n">n1</span><span class="o">.</span><span class="n">get_vibhakti</span><span class="p">()</span> <span class="o">==</span> <span class="n">n2</span><span class="o">.</span><span class="n">get_vibhakti</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">check_sambodhya</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Check sambodhya compatibility for dhatu d and node n &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get_vacana</span><span class="p">()</span> <span class="o">==</span> <span class="n">n</span><span class="o">.</span><span class="n">get_vacana</span><span class="p">())</span> <span class="ow">and</span> \
        <span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get_purusha</span><span class="p">()</span> <span class="o">==</span> <span class="nb">set</span><span class="p">([</span><span class="n">puruzas</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>


<span class="k">def</span> <span class="nf">jedge</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">strict_io</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">pada</span><span class="o">.</span><span class="n">canonical</span><span class="p">(</span><span class="n">strict_io</span><span class="o">=</span><span class="n">strict_io</span><span class="p">),</span>
            <span class="n">jtag</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getMorphologicalTags</span><span class="p">(),</span> <span class="n">strict_io</span><span class="p">),</span>
            <span class="n">SanskritImmutableString</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">SLP1</span><span class="p">)</span><span class="o">.</span><span class="n">canonical</span><span class="p">(</span><span class="n">strict_io</span><span class="o">=</span><span class="n">strict_io</span><span class="p">),</span>
            <span class="n">pred</span><span class="o">.</span><span class="n">pada</span><span class="o">.</span><span class="n">canonical</span><span class="p">(</span><span class="n">strict_io</span><span class="o">=</span><span class="n">strict_io</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">jnode</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">strict_io</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Helper to translate parse node into serializable format&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">pada</span><span class="o">.</span><span class="n">canonical</span><span class="p">(</span><span class="n">strict_io</span><span class="o">=</span><span class="n">strict_io</span><span class="p">),</span>
            <span class="n">jtag</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">getMorphologicalTags</span><span class="p">(),</span> <span class="n">strict_io</span><span class="p">),</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">jtag</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">strict_io</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Helper to translate tag to serializable format&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">canonical</span><span class="p">(</span><span class="n">strict_io</span><span class="o">=</span><span class="n">strict_io</span><span class="p">),</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">canonical</span><span class="p">(</span><span class="n">strict_io</span><span class="o">=</span><span class="n">strict_io</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>


<span class="k">def</span> <span class="nf">_non_projective</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Checks if an edge pair is non-projective &quot;&quot;&quot;</span>
    <span class="n">mnu</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">mxu</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">mnw</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">mxw</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mnu</span> <span class="o">&lt;</span> <span class="n">mnw</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">mxu</span> <span class="o">&lt;</span> <span class="n">mxw</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mxu</span> <span class="o">&gt;</span> <span class="n">mnw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mxu</span> <span class="o">&gt;</span> <span class="n">mxw</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">mnu</span> <span class="o">&gt;</span> <span class="n">mnw</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">mnu</span> <span class="o">&lt;</span> <span class="n">mxw</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_is_same_partition</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Are the two nodes n1 and n2 are in the same partition in psets &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">n1</span><span class="o">.</span><span class="n">index</span> <span class="o">==</span> <span class="n">n2</span><span class="o">.</span><span class="n">index</span>


<span class="k">def</span> <span class="nf">_get_base</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">getMorphologicalTags</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_order_parses</span><span class="p">(</span><span class="n">pu</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Order a set of parses by weight.</span>
<span class="sd">        &#39;&#39;&#39;</span>
    <span class="c1"># Sigma abs(n1-n2)</span>
    <span class="k">def</span> <span class="nf">_parse_cost</span><span class="p">(</span><span class="n">parse</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Multigraph (keys=False)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="n">parse</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">):</span>
            <span class="c1"># Abs Edge length times edge_type cost</span>
            <span class="n">_w</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">*</span> <span class="n">edge_cost</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">node_is_a</span><span class="p">(</span><span class="n">lakaras</span><span class="p">):</span>
                <span class="c1"># Lakaras are preferred</span>
                <span class="n">_w</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">_w</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="n">_w</span>
        <span class="k">return</span> <span class="n">w</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pu</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_parse_cost</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="p">[</span><span class="n">_parse_cost</span><span class="p">(</span><span class="n">te</span><span class="p">)</span> <span class="k">for</span> <span class="n">te</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>


<span class="c1"># Check a parse for validity</span>
<span class="k">def</span> <span class="nf">_check_parse</span><span class="p">(</span><span class="n">parse</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">smbds</span> <span class="o">=</span> <span class="n">samplabels</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">toedge</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">fromv</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">tov</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">sk</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">vsmbd</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">conj</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
    <span class="c1"># Multigraph (keys=False)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="n">parse</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">karakas</span><span class="p">:</span>
            <span class="n">count</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">toedge</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">toedge</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="s1">&#39;viSezaRam&#39;</span><span class="p">:</span>
            <span class="n">fromv</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">fromv</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">tov</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">tov</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">projlabels</span><span class="p">:</span>  <span class="c1"># Labels with sannidhi expectation</span>
            <span class="n">edges</span><span class="p">[(</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">smbds</span><span class="p">:</span>
            <span class="n">sk</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">sk</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="s1">&#39;vAkyasambanDaH&#39;</span><span class="p">:</span>
            <span class="n">vsmbd</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span>
            <span class="n">vsmbd</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">index</span>
        <span class="c1"># Conjuction nodes must have in and out edges</span>
        <span class="k">if</span> <span class="n">_get_base</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="ow">in</span> <span class="n">conjunctions</span><span class="p">:</span>
            <span class="n">conj</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s2">&quot;from&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conj</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s2">&quot;from&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">_get_base</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">conjunctions</span><span class="p">:</span>
            <span class="n">conj</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;to&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">conj</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="s2">&quot;to&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">count</span><span class="p">:</span>  <span class="c1"># Dhatu</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">count</span><span class="p">[</span><span class="n">u</span><span class="p">]:</span>  <span class="c1"># Each karaka should count only once</span>
            <span class="k">if</span> <span class="n">count</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Count for </span><span class="si">{</span><span class="n">u</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">count</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="si">}</span><span class="s2"> - violates global constraint&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">vi</span><span class="p">)</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">wi</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_non_projective</span><span class="p">(</span><span class="n">ui</span><span class="p">,</span> <span class="n">vi</span><span class="p">,</span> <span class="n">wi</span><span class="p">,</span> <span class="n">xi</span><span class="p">):</span>  <span class="c1"># Non-projective</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sannidhi violation </span><span class="si">{</span><span class="n">ui</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">vi</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">wi</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">xi</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">toedge</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">toedge</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Toedges for </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">toedge</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="si">}</span><span class="s2"> - violates global constraint&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">sk</span><span class="p">:</span>   <span class="c1"># Sambaddhakaraka = only one allowed from node</span>
        <span class="k">if</span> <span class="n">sk</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sambaddha karaka edges for </span><span class="si">{</span><span class="n">u</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">sk</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="si">}</span><span class="s2"> - violates global constraint&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tov</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">fromv</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Viseshana has visheshana </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> - violates global constraint&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Vakyasambabdha nodes - yadi/tarhi yatra/tatra etc cannot have links</span>
    <span class="c1"># beyond their partner</span>
    <span class="c1"># Multigraph (keys=False)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span> <span class="ow">in</span> <span class="n">parse</span><span class="o">.</span><span class="n">edges</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">vsmbd</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">vsmbd</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">vsmbd</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="p">]))</span> <span class="ow">or</span> \
               <span class="p">((</span><span class="n">vsmbd</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">vsmbd</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="p">])):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sannidhi violation for vAkyasambadDa </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">u</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">vsmbd</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span> <span class="ow">in</span> <span class="n">vsmbd</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">vsmbd</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">vsmbd</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]))</span> <span class="ow">or</span> \
               <span class="p">((</span><span class="n">vsmbd</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">vsmbd</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">])):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sannidhi violation for vAkyasambadDa </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">vsmbd</span><span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="c1"># Conjugations have to have one to and from edge</span>
    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">conj</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">conj</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s2">&quot;from&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">conj</span><span class="p">[</span><span class="n">u</span><span class="p">][</span><span class="s2">&quot;to&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Samyojaka violation for </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">conj</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">r</span>


<span class="c1"># Multigraph</span>
<span class="k">def</span> <span class="nf">multiedgesets</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">G</span><span class="p">):</span>
    <span class="n">medges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">edges</span><span class="p">:</span>
        <span class="n">medges</span><span class="o">.</span><span class="n">append</span><span class="p">([(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">G</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]]])</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">medges</span><span class="p">)]</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../sanskrit_parser.html">sanskrit_parser</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../sanskrit_parser_api.html">api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sanskrit_parser_cmd_line.html">cmd_line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sanskrit_parser_parser.html">parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sanskrit_parser_base.html">base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sanskrit_parser_util.html">util</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../sanskrit_parser.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017-2021, sanskrit-programmers.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>